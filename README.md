# dew
Domain Error Wrapper, combining causing error, domain error, custom message, and stacktrace in Go

## Example
```
package main

import (
	"errors"
	"fmt"
	"github.com/kristofferingemansson/dew"
)

func main() {
	var repo Repository = NewTestRepo()
	userService := NewUserService(repo)
	err := userService.Get("1")
	if err == nil {
		return
	}

	switch dew.Domain(err) {
	case ErrServiceOther:
		fmt.Println("Sending http 503", err.Error())
	case ErrServiceNotFound:
		fmt.Println("Sending http 404", err.Error())
	default:
		fmt.Println("Sending http 500", err.Error())
	}

	trace := dew.StackTrace(err)
	for _, r := range trace {
		fmt.Println(r)
	}
}

// Some Service
var (
	ErrServiceNotFound = errors.New("NotFound")
	ErrServiceOther    = errors.New("Other error")
)

type UserService struct {
	repo Repository
}

func NewUserService(repo Repository) *UserService {
	return &UserService{
		repo: repo,
	}
}

func (s *UserService) Get(ID string) error {
	if err := s.repo.Ping(); err != nil {
		switch dew.Domain(err) {
		case ErrRepositoryNotFound:
			return dew.New(ErrServiceNotFound, err, "Could not find user")
		case ErrRepositoryOther:
			return dew.New(ErrServiceOther, err, "Unknown error")
		default:
			return err
		}
	}

	// code for getting entity from repo

	return nil
}

///////////////////////////////////////////////////////////////////////////////

// Repository errors
var (
	ErrRepositoryNotFound = errors.New("Entity not found")
	ErrRepositoryOther    = errors.New("Other error")
)

// Repository ...
type Repository interface {
	Ping() error
}

///////////////////////////////////////////////////////////////////////////////

type testRepo struct{}

// NewTestRepo ...
func NewTestRepo() Repository {
	return &testRepo{}
}

// Ping ...
func (r *testRepo) Ping() error {
	// error generated by some library like cassandra or elasticsearch
	err := errors.New("Could not ping due to some reason")
	if err != nil {
		return dew.New(ErrRepositoryOther, err, "Could not ping repo '%T'", r)
	}

	return nil
}
```

```
Sending http 503 Other error: Unknown error: Other error: Could not ping repo '*main.testRepo': Could not ping due to some reason
github.com/kristofferingemansson/dew.New() @ dew/error.go:27
main.(*UserService).Get() @ `cmd/dew-test/main.go:54
main.main() @ cmd/dew-test/main.go:12
runtime.main() @ C:/Go/src/runtime/proc.go:185
runtime.goexit() @ C:/Go/src/runtime/asm_amd64.s:2197

```